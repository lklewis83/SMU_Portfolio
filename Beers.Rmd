---
title: "Beer Data"
author: "Lani Lewis"
date: "`r Sys.Date()`"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r include = FALSE}
# install.packages('rsconnect')
# install.packages("shiny")
# install.packages("askpass")
# install.packages("caret")
# install.packages("lubridate")
# install.packages("tidyverse")


# LIBRARIES ####
library(maps) # lat and long
library(usmap)
library(caret) # confusion Matrix
library(e1071) # navebayes
library(class) # knn
#library(tm) #text mining library provides the stopwords() function
library(tidyr)
#library(plyr)
#library(jsonlite)
library(dplyr)
library(tidyverse)
library(stringr) # string manipulation
#library(mvtnorm)
library(ggplot2)
library(ggthemes) # Plot Themes
library(plotly)
library(shiny)
library(rsconnect)
library(askpass)
```

```{r include = FALSE}
# Import Dataset
# getwd()
beers <- read.csv(file = "Beers.csv",header = T)
breweries <- read.csv("Breweries.csv",header = T)
state_abb_list <- read.csv("State_Abbrv_List.csv",header = T)

# Remove space before state abbreviation
breweries$State <- gsub("\\s", "", breweries$State)

# Change column names
colnames(state_abb_list)[1] <- c("Full_State")
colnames(state_abb_list)[3] <- c("State")

# Rename Column Names for Consistency and Merge Process
colnames(beers)[5] <- c("Brew_ID")
colnames(beers)[1] <- c("Beer_Name")

# Merge Data
beer_ds <- merge(beers,breweries, by = "Brew_ID")
plt_ds <- merge(beer_ds, state_abb_list, by = "State", all.x = T )


plt_ds = drop_na(plt_ds)
```


```{r echo = FALSE}
ui <- fluidPage(
  
  # App title ----
  titlePanel("Beer Strength App | removed na values"),
  
  # Sidebar layout with input and output definitions ----
  sidebarLayout(
    
    # Sidebar panel for inputs ----
    sidebarPanel(
      
      #Input: Slider for the number of bins ----
      sliderInput(inputId = "bins",
                  label = "Number Bars per Chart:",
                  min = 1,
                  max = 50,
                  value = 30),
      
      # Copy the line below to make a select box ####
      # ALL VALUES MUST BE UNIQUE as A VECTOR IS CREATED OFF the EQUAL VALUES
       selectInput("liquor",
                   label = h1("IBU or ABV Metric Selection"), 
                    choices = c("IBU_Histogram" ="IBU_Histogram",
                                   "ABV_Histogram" ="ABV_Histogram",                                                              "IBU_BoxPlot" = "IBU_BoxPlot", 
                                   "ABV_BoxPlot" = "ABV_BoxPlot"), 
                    ),

       
      # Second selection to select a state
      selectInput("state", "Select a State", state.name,
                  multiple = T,
                  selected = "Connecticut"),     
   
                    hr(),
      
                    fluidRow(column(3, verbatimTextOutput("value"))),      
                   

    ),
    
    # Main panel for displaying outputs ----
    mainPanel(
      
      # Output: Histogram ----
      plotOutput(outputId = "distPlot")
      
    )
  )
)
```


```{r echo = FALSE}
# Define server logic required to draw a histogram ----
server <- function(input, output) {
  
  # Histogram of the Old Faithful Geyser Data ----
  # with requested number of bins
  # This expression that generates a histogram is wrapped in a call
  # to renderPlot to indicate that:
  #
  # 1. It is "reactive" and therefore should be automatically
  #    re-executed when inputs (input$bins) change
  # 2. Its output type is a plot
  output$distPlot <- renderPlot({
    
    plt_ds <- filter(plt_ds, plt_ds$Full_State == input$state)
    
    if(input$liquor == "IBU_Histogram")
    {
    x    <- plt_ds$IBU 
    
    bins <- seq(min(x), max(x), length.out = input$bins + 1)
    
    
    hist(x, breaks = bins, col = "blue", border = "white",
         xlab = "IBU Values",
         ylab = "count",
         main = paste("Histogram of IBU Values Filtered By: " , plt_ds$Full_State))
    }
    if(input$liquor == "ABV_Histogram")
    {
    x    <- plt_ds$ABV 
    
    bins <- seq(min(x), max(x), length.out = input$bins + 1)
    
    hist(x, breaks = bins, col = "purple", border = "white",
         xlab = "ABV Values",
         ylab = "count",
         main = paste("Histogram of ABV Values Filtered By: " , plt_ds$Full_State))
    }
    if(input$liquor == "IBU_BoxPlot")
    {
    x    <- plt_ds$IBU  
    
    bins <- seq(min(x), max(x), length.out = input$bins + 1)
    
    boxplot(x, breaks = bins, col = "cyan", border = "white",
         xlab = "IBU Values",
         ylab = "count",
         main = paste("Boxplot of IBU Values Filtered By: " , plt_ds$Full_State))
    }
    if(input$liquor == "ABV_BoxPlot")
    {
    x    <- plt_ds$ABV 
    
    bins <- seq(min(x), max(x), length.out = input$bins + 1)
    
    boxplot(x, breaks = bins, col = "plum", border = "white",
         xlab = "ABV Values",
         ylab = "count",
         main = paste("Boxplot of ABV Values Filtered By: "  , plt_ds$Full_State))
    }
  })
  
}

shinyApp(ui, server)

```
